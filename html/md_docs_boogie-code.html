<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Inline Boogie Code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Inline Boogie Code </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In order to pass custom Boogie code through SMACK's translation from C code, SMACK interprets calls to the following procedures (declared in <code>smack.h</code>) specially:</p>
<ul>
<li><code>void <a class="el" href="smack_8h.html#ac5dbb408d3d8da7a6f0050432ebfc66b">__SMACK_code(const char *fmt, ...)</a>;</code></li>
<li><code>void <a class="el" href="smack_8h.html#aaa1dcd962568d7361267c366d24bcb2d">__SMACK_decl(const char *fmt, ...)</a>;</code></li>
<li><code>void <a class="el" href="smack_8h.html#a0275c6d402e09bb1a62a430d62beb68b">__SMACK_top_decl(const char *fmt, ...)</a>;</code></li>
</ul>
<p>SMACK translates the call <code>__SMACK_code("assume x == y;")</code> directly into the Boogie statement <code>assume x == y;</code>. For variable declarations, SMACK translates the call <code>__SMACK_decl("var x: int;")</code> into a declaration <code>var x: int;</code> in the calling procedure, and the call <code>__SMACK_top_decl("var y: int;")</code> into a global declaration <code>var y: int</code>. This last form can in fact be used for any kind of global declaration, for instance, </p><div class="fragment"><div class="line">__SMACK_top_decl(&quot;function f(int,int) returns (int);&quot;)</div>
<div class="line">__SMACK_top_decl(&quot;axiom f(0,0) == 10;&quot;)</div>
</div><!-- fragment --><p>declares a Boogie function <code>f</code> constrained by the axiom <code>f(0,0) == 10</code>.</p>
<p>Given this functionality, it can also be useful to write custom Boogie code which uses program values defined in the source-level C code. This is made possible by interpreting the string passed as the first argument to <code>__SMACK_code</code>, <code>__SMACK_decl</code>, and <code>__SMACK_top_decl</code> as a format string, in which each occurrence of the <code>@</code> symbol is replaced by a subsequent argument. For instance, consider the following implementations of <code>smack.h</code> </p><div class="fragment"><div class="line">void assert(bool v) {</div>
<div class="line">  __SMACK_code(&quot;assert @ != 0;&quot;, v);</div>
<div class="line">}</div>
<div class="line">void assume(bool v) {</div>
<div class="line">  __SMACK_code(&quot;assume @ != 0;&quot;, v);</div>
<div class="line">}</div>
</div><!-- fragment --><p>SMACK interprets the <code>@</code> symbol by inserting the value of the C variable <code>v</code>. Since the arguments of variadic functions may be promoted, SMACK allows users to append a format character to the <code>@</code> symbol as an indicator that the argument, rather than its promoted form, should be used in the format string. We allow the following format characters (inspired by Python and C) for the respective C types: <code>c</code> (<code>char</code>), <code>b</code> (<code>signed char</code>), <code>B</code> (<code>unsigned char</code>), <code>h</code> (<code>signed short</code>), <code>H</code> (<code>unsigned short</code>), <code>i</code> (<code>signed int</code>), <code>I</code> (<code>unsigned int</code>) and <code>f</code> (<code>float</code>).</p>
<p>For example, without using such annotations, the definition of the <code>floorf</code> function is: </p><div class="fragment"><div class="line"><span class="keywordtype">float</span> <a class="code" href="math_8h.html#a0bcc6aa4b3c37bfa73f06ebdecc0d247">floorf</a>(<span class="keywordtype">float</span> <a class="code" href="loop_8c.html#a6150e0515f7202e2fb518f7206ed97dc">x</a>) {</div>
<div class="line">  <span class="keywordtype">double</span> ret = __VERIFIER_nondet_double();</div>
<div class="line">  <a class="code" href="smack_8h.html#ac5dbb408d3d8da7a6f0050432ebfc66b">__SMACK_code</a>(<span class="stringliteral">&quot;@ := ftd($rmode, $round.bvfloat(RTN, dtf($rmode, @)));&quot;</span>, ret, <a class="code" href="loop_8c.html#a6150e0515f7202e2fb518f7206ed97dc">x</a>);</div>
<div class="line">   <span class="keywordflow">return</span> ret;</div>
<div class="line"> }</div>
</div><!-- fragment --><p>where the <code>ftd</code> and <code>dtf</code> functions are conversions between <code>float</code> and <code>double</code> variables that are needed to deal with the promotion of the arguments. Whereas a better definition using these annotations is: </p><div class="fragment"><div class="line"><span class="keywordtype">float</span> <a class="code" href="math_8h.html#a0bcc6aa4b3c37bfa73f06ebdecc0d247">floorf</a>(<span class="keywordtype">float</span> <a class="code" href="loop_8c.html#a6150e0515f7202e2fb518f7206ed97dc">x</a>) {</div>
<div class="line">  <span class="keywordtype">float</span> ret = __VERIFIER_nondet_float();</div>
<div class="line">  <a class="code" href="smack_8h.html#ac5dbb408d3d8da7a6f0050432ebfc66b">__SMACK_code</a>(<span class="stringliteral">&quot;@f := $round.bvfloat(RTN, @f);&quot;</span>, ret, <a class="code" href="loop_8c.html#a6150e0515f7202e2fb518f7206ed97dc">x</a>);</div>
<div class="line">   <span class="keywordflow">return</span> ret;</div>
<div class="line"> }</div>
</div><!-- fragment --><p>One application of this functionality which has been valuable to the authors of SMACK is in encoding concurrency primitives into the generated Boogie code. The following generates four procedure calls marked as <em>asynchronous</em>: </p><div class="fragment"><div class="line">__SMACK_decl(&quot;var x: int;&quot;);</div>
<div class="line">__SMACK_code(&quot;call {:async} @(@);&quot;, Push, 1);</div>
<div class="line">__SMACK_code(&quot;call {:async} @(@);&quot;, Push, 2);</div>
<div class="line">__SMACK_code(&quot;call {:async} x := @();&quot;, Pop);</div>
<div class="line">__SMACK_code(&quot;call {:async} x := @();&quot;, Pop);</div>
</div><!-- fragment --><p>While the <code>{:async}</code> attributes have no intrinsic meaning in Boogie, they can be used as directives for other tools that interpret concurrency primitives, such as Corral. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aloop_8c_html_a6150e0515f7202e2fb518f7206ed97dc"><div class="ttname"><a href="loop_8c.html#a6150e0515f7202e2fb518f7206ed97dc">x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> loop.c:11</div></div>
<div class="ttc" id="amath_8h_html_a0bcc6aa4b3c37bfa73f06ebdecc0d247"><div class="ttname"><a href="math_8h.html#a0bcc6aa4b3c37bfa73f06ebdecc0d247">floorf</a></div><div class="ttdeci">float floorf(float x)</div><div class="ttdef"><b>Definition:</b> math.c:44</div></div>
<div class="ttc" id="asmack_8h_html_ac5dbb408d3d8da7a6f0050432ebfc66b"><div class="ttname"><a href="smack_8h.html#ac5dbb408d3d8da7a6f0050432ebfc66b">__SMACK_code</a></div><div class="ttdeci">void __SMACK_code(const char *fmt,...)</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
